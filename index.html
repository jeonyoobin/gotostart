<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoToStart</title>
    <style>
        :root {
            --bg-color: #f5f5f7; 
            --text-main: #3d444b; 
            --point-blue: #7fb3d5; 
            --line-color: #555555; 
            --nm-out: 6px 6px 14px #d1d1d6, -6px -6px 14px #ffffff;
            --nm-in: inset 3px 3px 7px #d1d1d6, inset -2px -2px 7px #ffffff;
            --nm-btn: 3px 3px 8px #d1d1d6, -2px -2px 6px #ffffff;
            --nm-btn-hover: 4px 4px 10px #c8c8cf, -3px -3px 8px #ffffff;
        }

        * { scrollbar-gutter: stable; box-sizing: border-box; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }

        body { 
            background: var(--bg-color); color: var(--text-main); 
            font-family: 'Inter', 'Pretendard', sans-serif; 
            margin: 0; padding: 0; height: 100vh; width: 100vw; overflow: hidden;
            -webkit-user-select: none; user-select: none;
        }

        /* 드래그 가능한 상단 영역 (Nativefier용) */
        #title-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 30px;
            -webkit-app-region: drag; z-index: 9999;
        }

        #project-viewport { 
            display: flex; width: 100%; height: 100vh; 
            transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); 
        }

        .project-card { 
            min-width: 100%; height: 100vh; 
            overflow-y: auto; overflow-x: hidden; 
            display: flex; flex-direction: column; align-items: center; 
        }

        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; height: 100px; pointer-events: none; z-index: 9000; display: flex; justify-content: center; align-items: center; background: linear-gradient(to top, var(--bg-color) 40%, transparent); }
        .nav-btn { position: absolute; bottom: 25px; width: 34px; height: 34px; border-radius: 50%; background: var(--bg-color); box-shadow: var(--nm-btn); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; color: #555; opacity: 0; transition: 0.3s; pointer-events: auto; }
        .nav-left { left: 20px; } .nav-right { right: 20px; }

        .page-indicator { position: absolute; bottom: 30px; display: flex; flex-direction: column; align-items: center; opacity: 0; transition: 0.3s; }
        .page-text { font-size: 11px; font-weight: 700; color: #999; letter-spacing: 1px; }

        .top-menu { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 9900; -webkit-app-region: no-drag; } 
        .menu-btn { width: 32px; height: 32px; border-radius: 50%; background: var(--bg-color); box-shadow: var(--nm-btn); display: flex; align-items: center; justify-content: center; cursor: pointer; color: #555; transition: 0.2s; font-size: 14px; }
        .stop-icon { width: 8px; height: 8px; background: #555; border-radius: 1px; }

        .task-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; padding-bottom: 120px; }
        .scroll-spacer { height: 150px; flex-shrink: 0; }

        .task-list { display: flex; flex-direction: column-reverse; align-items: center; width: 100%; }
        .task-wrapper { width: 100%; display: flex; flex-direction: column; align-items: center; transition: 0.4s ease; }
        .task-wrapper.completed { opacity: 0; height: 0; overflow: hidden; margin: 0; }
        .task-wrapper.is-hidden { display: none; }
        .task-wrapper.is-waiting { opacity: 0.3; pointer-events: none; transform: scale(0.95); }

        .input-group { width: 100%; display: flex; justify-content: center; padding: 10px 0; }
        .input-container { 
            position: relative; display: flex; align-items: center; 
            background: var(--bg-color); border-radius: 14px; box-shadow: var(--nm-out); 
            width: 85%; max-width: 280px; padding: 0 40px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .task-input { background: transparent; border: none; padding: 15px 0; font-size: 13px; font-weight: 600; color: var(--text-main); width: 100%; text-align: center; outline: none; }
        
        .btn-icon { position: absolute; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 50%; background: var(--bg-color); box-shadow: var(--nm-btn); transition: 0.2s; opacity: 0; }
        .start-trigger { left: 8px; color: var(--point-blue); }
        .delete-trigger { right: 8px; color: #ff8a8a; font-size: 12px; }

        .input-container:hover .btn-icon { opacity: 1; }
        .is-hero .input-container { transform: scale(1.05); background: #ffffff; width: 90%; }
        .is-hero .start-trigger { opacity: 1 !important; }

        .inner-toggle { position: absolute; right: 8px; display: none; }
        .is-hero .inner-toggle { display: flex; }
        .is-hero .delete-trigger { display: none; }

        .toggle-frame { width: 34px; height: 18px; background: #e0e0e0; border-radius: 10px; position: relative; cursor: pointer; transition: 0.3s; }
        .toggle-circle { width: 12px; height: 12px; background: #fff; border-radius: 50%; position: absolute; left: 3px; top: 3px; transition: 0.3s; }
        .toggle-frame.active { background: var(--point-blue); }
        .toggle-frame.active .toggle-circle { left: 19px; }

        .bridge-zone { height: 40px; width: 100%; position: relative; display: flex; align-items: center; justify-content: center; }
        .bridge-line { width: 1.5px; height: 100%; background: var(--line-color); opacity: 0.1; }
        .bridge-add-btn { position: absolute; width: 22px; height: 22px; background: var(--bg-color); border-radius: 50%; color: var(--point-blue); box-shadow: var(--nm-btn); cursor: pointer; opacity: 0; transition: 0.2s; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; }
        .bridge-zone:hover .bridge-add-btn { opacity: 1; }

        .play-icon { width: 0; height: 0; border-top: 5px solid transparent; border-bottom: 5px solid transparent; border-left: 8px solid #555; margin-left: 2px; }
        .pause-icon { display: flex; gap: 3px; } .pause-icon div { width: 3px; height: 10px; background: #555; }

        #finish-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; background: var(--bg-color); z-index: 8000; }
        .select-main { width: 220px; padding: 15px 20px; background: var(--bg-color); border-radius: 14px; box-shadow: var(--nm-btn); display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 13px; font-weight: 700; }
        
        #ending-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; z-index: 9800; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(180deg, #dbeafe 0%, #f5f5f7 100%); }
        .plane-icon { width: 60px; height: 60px; fill: #444; animation: plane-fly 4s ease-in-out infinite; }
        @keyframes plane-fly { 0%, 100% { transform: translate(0,0) rotate(5deg); } 50% { transform: translate(15px,-20px) rotate(-5deg); } }

        body.empty-state #project-viewport, body.empty-state .nav-bar { display: none !important; }
    </style>
</head>
<body onmousemove="handleNavVisibility(event)">
    <div id="title-bar"></div>

    <div id="ending-overlay">
        <svg class="plane-icon" viewBox="0 0 24 24"><path d="M21 3L3 10.53V11.5L9.84 13.67L12 20.33L13 21L21 3M19.34 5.34L11.5 13.18L10.32 9.68L19.34 5.34M13.18 11.5L14.32 18.68L18.66 9.66L13.18 11.5Z"/></svg>
        <p style="margin-top:20px; color:#666; font-size:14px; font-weight:600;">모든 짐을 내려놓았습니다.</p>
    </div>

    <div class="top-menu">
        <div class="menu-btn" onclick="playSound('H'); handleHome();"><div class="stop-icon"></div></div>
        <div class="menu-btn" onclick="window.close();">✕</div>
    </div>

    <div class="nav-bar">
        <div class="nav-btn nav-left" id="btn-left" onclick="playSound('H'); moveProject(-1)">❮</div>
        <div class="page-indicator" id="indicator">
            <div class="page-text" id="page-num">1 / 1</div>
            <div class="menu-btn" style="margin-top:10px; width:24px; height:24px; font-size:10px;" onclick="deleteProject()">✕</div>
        </div>
        <div class="nav-btn nav-right" id="btn-right" onclick="playSound('H'); moveProject(1)">❯</div>
    </div>

    <div id="project-viewport"></div>

    <div id="finish-screen">
        <div class="select-main" onclick="completeProject()">
            <span>이 프로젝트 완료하기</span>
            <div class="play-icon" style="transform: rotate(-90deg);"></div>
        </div>
        <p onclick="handleHome()" style="margin-top:20px; font-size:12px; color:#999; cursor:pointer;">처음으로 돌아가기</p>
    </div>

    <script>
        // --- 사운드 설정 (유빈이가 사용하는 파일명 기준) ---
        const sounds = {};
        ['A','B','C','D','E','F','G','H'].forEach(name => {
            sounds[name] = new Audio(`https://raw.githubusercontent.com/jeonyoobin/gotostart/main/sounds/${name}.mp3`);
        });
        function playSound(name) { 
            if(sounds[name]) {
                sounds[name].currentTime = 0;
                sounds[name].play().catch(() => {});
            }
        }

        let projects = JSON.parse(localStorage.getItem('gtstart_data')) || [{ tasks: [{ val: "너를 짓누르는 그 일을 적어봐", isMain: true }] }];
        let currentIdx = 0;

        function save() {
            localStorage.setItem('gtstart_data', JSON.stringify(projects));
        }

        function render() {
            const vp = document.getElementById('project-viewport');
            vp.innerHTML = '';
            projects.forEach((proj, pIdx) => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <div class="task-container">
                        <div class="scroll-spacer"></div>
                        <div class="task-list"></div>
                    </div>`;
                const list = card.querySelector('.task-list');
                proj.tasks.forEach((t, tIdx) => {
                    list.appendChild(createTaskEl(t.val, t.isMain));
                });
                vp.appendChild(card);
            });
            updateView();
        }

        function createTaskEl(val, isMain) {
            const wrapper = document.createElement('div');
            wrapper.className = `task-wrapper ${isMain ? 'main-task' : ''}`;
            wrapper.innerHTML = `
                <div class="bridge-zone"><div class="bridge-line"></div><div class="bridge-add-btn" onclick="addTask(this)">+</div></div>
                <div class="input-group">
                    <div class="input-container">
                        <div class="btn-icon start-trigger" onclick="toggleFocus(this)"><div class="play-icon"></div></div>
                        <input type="text" class="task-input" value="${val}" onfocus="if(this.value.includes('?'))this.value=''" onchange="updateData()">
                        <div class="inner-toggle"><div class="toggle-frame" onclick="doToggle(this)"><div class="toggle-circle"></div></div></div>
                        <div class="btn-icon delete-trigger" onclick="deleteTask(this)">✕</div>
                    </div>
                </div>`;
            return wrapper;
        }

        function updateView() {
            const vp = document.getElementById('project-viewport');
            vp.style.transform = `translateX(-${currentIdx * 100}%)`;
            document.getElementById('page-num').innerText = `${currentIdx + 1} / ${projects.length}`;
            document.getElementById('btn-left').style.display = currentIdx === 0 ? 'none' : 'flex';
        }

        function moveProject(dir) {
            currentIdx += dir;
            if (currentIdx >= projects.length) {
                projects.push({ tasks: [{ val: "새로운 짐을 적어봐", isMain: true }] });
            }
            if (currentIdx < 0) currentIdx = 0;
            render();
            save();
        }

        function deleteProject() {
            if(projects.length <= 1) return;
            projects.splice(currentIdx, 1);
            currentIdx = Math.max(0, currentIdx - 1);
            render();
            save();
        }

        function addTask(btn) {
            playSound('A');
            const wrapper = btn.closest('.task-wrapper');
            const list = wrapper.parentElement;
            const newNode = createTaskEl("그 다음 할 일은?", false);
            list.insertBefore(newNode, wrapper.nextSibling);
            updateData();
        }

        function deleteTask(btn) {
            playSound('C');
            btn.closest('.task-wrapper').remove();
            updateData();
        }

        function toggleFocus(btn) {
            const wrapper = btn.closest('.task-wrapper');
            const body = document.body;
            if (!wrapper.classList.contains('is-hero')) {
                playSound('B');
                body.classList.add('has-hero');
                wrapper.classList.add('is-hero');
                btn.innerHTML = '<div class="pause-icon"><div></div><div></div></div>';
                updateStates(wrapper);
            } else {
                playSound('E');
                resetFocus();
            }
        }

        function resetFocus() {
            document.body.classList.remove('has-hero');
            document.querySelectorAll('.task-wrapper').forEach(el => {
                el.classList.remove('is-hero', 'is-waiting', 'is-hidden');
                const btn = el.querySelector('.start-trigger');
                if(btn) btn.innerHTML = '<div class="play-icon"></div>';
            });
        }

        function updateStates(hero) {
            const list = hero.parentElement;
            const items = Array.from(list.querySelectorAll('.task-wrapper'));
            const idx = items.indexOf(hero);
            items.forEach((el, i) => {
                if(i < idx) el.classList.add('is-waiting');
                else if(i > idx) el.classList.add('is-hidden');
            });
        }

        function doToggle(el) {
            if (el.classList.contains('active')) return;
            playSound('D');
            el.classList.add('active');
            const current = el.closest('.task-wrapper');
            
            setTimeout(() => {
                current.classList.add('completed');
                const next = Array.from(current.parentElement.querySelectorAll('.task-wrapper:not(.completed)')).pop();
                if (next) {
                    resetFocus();
                    const nextBtn = next.querySelector('.start-trigger');
                    toggleFocus(nextBtn);
                } else {
                    playSound('F');
                    document.getElementById('finish-screen').style.display = 'flex';
                }
            }, 500);
        }

        function completeProject() {
            if(projects.length > 1) {
                projects.splice(currentIdx, 1);
                currentIdx = 0;
                document.getElementById('finish-screen').style.display = 'none';
                resetFocus();
                render();
            } else {
                document.getElementById('finish-screen').style.display = 'none';
                document.getElementById('ending-overlay').style.display = 'flex';
                setTimeout(() => { location.reload(); }, 4000);
            }
            save();
        }

        function updateData() {
            const cards = document.querySelectorAll('.project-card');
            projects = Array.from(cards).map(card => {
                const inputs = Array.from(card.querySelectorAll('.task-input'));
                return { tasks: inputs.map((input, i) => ({ val: input.value, isMain: i === (inputs.length-1) })) };
            });
            save();
        }

        function handleHome() {
            localStorage.removeItem('gtstart_data');
            location.reload();
        }

        function handleNavVisibility(e) {
            const nav = document.querySelector('.nav-bar');
            const indicator = document.getElementById('indicator');
            const btns = document.querySelectorAll('.nav-btn');
            if (e.clientY > window.innerHeight - 80) {
                indicator.style.opacity = 1;
                btns.forEach(b => b.style.opacity = 0.8);
            } else {
                indicator.style.opacity = 0;
                btns.forEach(b => b.style.opacity = 0);
            }
        }

        window.onload = render;
    </script>
</body>
</html>
